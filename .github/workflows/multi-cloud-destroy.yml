name: Multi-Cloud Infrastructure Destroy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to destroy'
        required: true
        type: choice
        options:
          - dev
          - staging
          # Production is NOT available - must be destroyed manually with approval
      destroy_mongodb:
        description: 'ðŸ”¥ Destroy MongoDB Atlas (PERMANENT DATA LOSS - Cannot be recovered)'
        required: false
        type: boolean
        default: false
      destroy_cloudflare:
        description: 'ðŸ”¥ Destroy Cloudflare R2 (ALL FILES DELETED - Cannot be recovered)'
        required: false
        type: boolean
        default: false
      destroy_azure:
        description: 'Destroy Azure Container Apps (Stateless - Safe to recreate)'
        required: false
        type: boolean
        default: false
      confirmation:
        description: 'Type "DESTROY-{environment}" to confirm (e.g., "DESTROY-dev")'
        required: true
        type: string

permissions:
  id-token: write      # Required for OIDC authentication with Azure
  contents: read       # Required for checking out code

env:
  TERRAFORM_VERSION: '1.6.0'
  MONGODB_TERRAFORM_DIR: 'dculus-forms/infrastructure/multi-cloud/terraform/mongodb'
  CLOUDFLARE_TERRAFORM_DIR: 'dculus-forms/infrastructure/multi-cloud/terraform/cloudflare'
  AZURE_TERRAFORM_DIR: 'dculus-forms/infrastructure/multi-cloud/terraform/azure'

jobs:
  # Validate destroy request and confirmation
  validate-destroy-request:
    name: Validate Destroy Request
    runs-on: ubuntu-latest
    outputs:
      confirmed: ${{ steps.validate.outputs.confirmed }}
      environment: ${{ github.event.inputs.environment }}
    steps:
      - name: Validate Confirmation
        id: validate
        run: |
          EXPECTED="DESTROY-${{ github.event.inputs.environment }}"
          ACTUAL="${{ github.event.inputs.confirmation }}"

          echo "Expected confirmation: $EXPECTED"
          echo "Actual confirmation: $ACTUAL"

          if [ "$ACTUAL" != "$EXPECTED" ]; then
            echo "âŒ ERROR: Confirmation does not match!"
            echo "Expected: $EXPECTED"
            echo "Got: $ACTUAL"
            exit 1
          fi

          echo "âœ… Confirmation verified: $ACTUAL"
          echo "confirmed=true" >> $GITHUB_OUTPUT

      - name: Verify At Least One Provider Selected
        run: |
          if [ "${{ github.event.inputs.destroy_mongodb }}" != "true" ] && \
             [ "${{ github.event.inputs.destroy_cloudflare }}" != "true" ] && \
             [ "${{ github.event.inputs.destroy_azure }}" != "true" ]; then
            echo "âŒ ERROR: No providers selected for destruction!"
            echo "Please select at least one provider to destroy."
            exit 1
          fi

          echo "âœ… At least one provider selected for destruction"

      - name: Display Destruction Plan
        run: |
          echo "ðŸ”¥ DESTRUCTION PLAN ðŸ”¥"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Environment: ${{ github.event.inputs.environment }}"
          echo "Triggered by: @${{ github.actor }}"
          echo ""
          echo "Resources to be destroyed:"

          if [ "${{ github.event.inputs.destroy_azure }}" = "true" ]; then
            echo "  âœ… Azure Container Apps (Stateless)"
          else
            echo "  â­ï¸ Azure Container Apps (Skipped)"
          fi

          if [ "${{ github.event.inputs.destroy_cloudflare }}" = "true" ]; then
            echo "  ðŸ”¥ Cloudflare R2 Buckets (ALL FILES DELETED)"
          else
            echo "  â­ï¸ Cloudflare R2 (Skipped)"
          fi

          if [ "${{ github.event.inputs.destroy_mongodb }}" = "true" ]; then
            echo "  âš ï¸âš ï¸âš ï¸ MongoDB Atlas (PERMANENT DATA LOSS)"
          else
            echo "  â­ï¸ MongoDB Atlas (Skipped)"
          fi

          echo ""
          echo "âš ï¸ WARNING: This action cannot be undone!"

  # Cleanup Azure Custom Domain and Certificate before destroying infrastructure
  cleanup-azure-custom-domain:
    name: Cleanup Custom Domain & Certificate
    runs-on: ubuntu-latest
    needs: validate-destroy-request
    if: github.event.inputs.destroy_azure == 'true'
    environment: ${{ github.event.inputs.environment }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Azure Login (OIDC)
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Set environment variables
        run: |
          ENV="${{ github.event.inputs.environment }}"
          echo "RESOURCE_GROUP=dculus-forms-${ENV}-rg" >> $GITHUB_ENV
          echo "CONTAINER_APP_NAME=dculus-forms-${ENV}-backend" >> $GITHUB_ENV
          echo "CONTAINER_ENV_NAME=dculus-forms-${ENV}-env" >> $GITHUB_ENV
          echo "CUSTOM_DOMAIN=form-services-${ENV}.dculus.com" >> $GITHUB_ENV
          echo "ENVIRONMENT=${ENV}" >> $GITHUB_ENV

      - name: Run cleanup script
        env:
          CLOUDFLARE_ZONE_ID: ${{ secrets.CLOUDFLARE_ZONE_ID }}
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          chmod +x .github/scripts/cleanup-azure-custom-domain.sh
          ./.github/scripts/cleanup-azure-custom-domain.sh || {
            echo "âš ï¸ Cleanup failed but continuing with destruction"
            exit 0
          }

      - name: Display cleanup summary
        if: always()
        run: |
          echo "==================== Cleanup Summary ===================="
          echo "Custom Domain: form-services-${{ github.event.inputs.environment }}.dculus.com"
          echo "âœ… Custom domain cleanup completed"
          echo "Infrastructure destruction will proceed..."
          echo "================================================================"

  # Destroy Azure Container Apps (Stateless - Safe)
  terraform-azure-destroy:
    name: Destroy Azure Container Apps
    runs-on: ubuntu-latest
    needs: [validate-destroy-request, cleanup-azure-custom-domain]
    if: |
      always() && !cancelled() &&
      (needs.cleanup-azure-custom-domain.result == 'success' || needs.cleanup-azure-custom-domain.result == 'skipped') &&
      github.event.inputs.destroy_azure == 'true'
    environment: ${{ github.event.inputs.environment }}
    defaults:
      run:
        working-directory: ${{ env.AZURE_TERRAFORM_DIR }}/environments/${{ github.event.inputs.environment }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          path: dculus-forms

      - name: Azure Login (OIDC)
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Get Azure Storage Account Key
        run: |
          ACCOUNT_KEY=$(az storage account keys list \
            --resource-group dculus-global-terraform-assets-resource-grp \
            --account-name dculusterraformstates \
            --query '[0].value' -o tsv)
          echo "::add-mask::$ACCOUNT_KEY"
          echo "ARM_ACCESS_KEY=$ACCOUNT_KEY" >> $GITHUB_ENV

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TERRAFORM_VERSION }}

      - name: Copy shared Terraform files
        run: |
          cp ../../main.tf .
          cp ../../variables.tf .
          cp ../../outputs.tf .
          echo "âœ… Copied shared Terraform files"

      - name: Terraform Init
        run: terraform init

      - name: Terraform Destroy
        env:
          TF_VAR_mongodb_connection_string: "placeholder"
          TF_VAR_better_auth_secret: ${{ secrets.BETTER_AUTH_SECRET }}
          TF_VAR_s3_access_key: ${{ secrets.S3_ACCESS_KEY }}
          TF_VAR_s3_secret_key: ${{ secrets.S3_SECRET_KEY }}
          TF_VAR_s3_endpoint: ${{ secrets.S3_ENDPOINT }}
          TF_VAR_s3_cdn_url: ${{ secrets.S3_PUBLIC_CDN_URL }}
          TF_VAR_s3_private_bucket_name: ${{ secrets.S3_PRIVATE_BUCKET_NAME }}
          TF_VAR_s3_public_bucket_name: ${{ secrets.S3_PUBLIC_BUCKET_NAME }}
          TF_VAR_cors_origins: ${{ secrets.CORS_ORIGINS }}
          TF_VAR_container_image_tag: "placeholder"
        run: |
          echo "ðŸ”¥ Destroying Azure Container Apps..."
          terraform destroy -auto-approve
          echo "âœ… Azure Container Apps destroyed successfully"

  # Destroy Cloudflare R2 Buckets (File Storage)
  terraform-cloudflare-destroy:
    name: Destroy Cloudflare R2 Buckets
    runs-on: ubuntu-latest
    needs: [validate-destroy-request, terraform-azure-destroy]
    if: |
      always() && !cancelled() &&
      (needs.terraform-azure-destroy.result == 'success' || needs.terraform-azure-destroy.result == 'skipped') &&
      github.event.inputs.destroy_cloudflare == 'true'
    environment: ${{ github.event.inputs.environment }}
    defaults:
      run:
        working-directory: ${{ env.CLOUDFLARE_TERRAFORM_DIR }}/environments/${{ github.event.inputs.environment }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          path: dculus-forms

      - name: Azure Login (OIDC)
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Get Azure Storage Account Key
        run: |
          ACCOUNT_KEY=$(az storage account keys list \
            --resource-group dculus-global-terraform-assets-resource-grp \
            --account-name dculusterraformstates \
            --query '[0].value' -o tsv)
          echo "::add-mask::$ACCOUNT_KEY"
          echo "ARM_ACCESS_KEY=$ACCOUNT_KEY" >> $GITHUB_ENV

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TERRAFORM_VERSION }}

      - name: Copy shared Terraform files
        run: |
          cp ../../main.tf .
          cp ../../variables.tf .
          cp ../../r2-buckets.tf .
          cp ../../r2-custom-domains.tf .
          cp ../../outputs.tf .
          echo "âœ… Copied shared Terraform files"

      - name: Terraform Init
        run: |
          terraform init \
            -backend-config="resource_group_name=dculus-global-terraform-assets-resource-grp" \
            -backend-config="storage_account_name=dculusterraformstates" \
            -backend-config="container_name=dculus-forms-cloudflare-r2-${{ github.event.inputs.environment }}-state" \
            -backend-config="key=terraform.tfstate"

      - name: Warning - Files Will Be Deleted
        run: |
          echo "âš ï¸âš ï¸âš ï¸ WARNING âš ï¸âš ï¸âš ï¸"
          echo "All files in the following buckets will be PERMANENTLY DELETED:"
          echo "  - dculus-forms-private-${{ github.event.inputs.environment }}"
          echo "  - dculus-forms-public-${{ github.event.inputs.environment }}"
          echo ""
          echo "This includes:"
          echo "  - User uploads"
          echo "  - Form attachments"
          echo "  - Public assets"
          echo "  - All other files"
          echo ""
          echo "âš ï¸ NO BACKUPS - CANNOT BE RECOVERED âš ï¸"

      - name: Terraform Destroy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          TF_VAR_cloudflare_account_id: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          TF_VAR_cloudflare_zone_id: ${{ secrets.CLOUDFLARE_ZONE_ID }}
          TF_VAR_cloudflare_api_token: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          echo "ðŸ”¥ Destroying Cloudflare R2 buckets and CDN configuration..."
          terraform destroy -auto-approve \
            -var="cloudflare_account_id=${{ secrets.CLOUDFLARE_ACCOUNT_ID }}" \
            -var="cloudflare_api_token=${{ secrets.CLOUDFLARE_API_TOKEN }}" \
            -var="cloudflare_zone_id=${{ secrets.CLOUDFLARE_ZONE_ID }}"
          echo "âœ… Cloudflare R2 buckets and CDN destroyed successfully"

  # Destroy MongoDB Atlas (Database with ALL Data)
  terraform-mongodb-destroy:
    name: Destroy MongoDB Atlas Database
    runs-on: ubuntu-latest
    needs: [validate-destroy-request, terraform-cloudflare-destroy]
    if: |
      always() && !cancelled() &&
      (needs.terraform-cloudflare-destroy.result == 'success' || needs.terraform-cloudflare-destroy.result == 'skipped') &&
      github.event.inputs.destroy_mongodb == 'true'
    environment: ${{ github.event.inputs.environment }}
    defaults:
      run:
        working-directory: ${{ env.MONGODB_TERRAFORM_DIR }}/environments/${{ github.event.inputs.environment }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          path: dculus-forms

      - name: Azure Login (OIDC)
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Get Azure Storage Account Key
        run: |
          ACCOUNT_KEY=$(az storage account keys list \
            --resource-group dculus-global-terraform-assets-resource-grp \
            --account-name dculusterraformstates \
            --query '[0].value' -o tsv)
          echo "::add-mask::$ACCOUNT_KEY"
          echo "ARM_ACCESS_KEY=$ACCOUNT_KEY" >> $GITHUB_ENV

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: ${{ env.TERRAFORM_VERSION }}

      - name: Copy shared Terraform files
        run: |
          cp ../../main.tf .
          cp ../../variables.tf .
          cp ../../cluster.tf .
          cp ../../database-user.tf .
          cp ../../network-access.tf .
          cp ../../outputs.tf .
          echo "âœ… Copied shared Terraform files"

      - name: Terraform Init
        env:
          TF_VAR_mongodb_atlas_public_key: ${{ secrets.MONGODB_ATLAS_PUBLIC_KEY }}
          TF_VAR_mongodb_atlas_private_key: ${{ secrets.MONGODB_ATLAS_PRIVATE_KEY }}
          TF_VAR_mongodb_atlas_org_id: ${{ secrets.MONGODB_ATLAS_ORG_ID }}
          TF_VAR_database_password: ${{ secrets.MONGODB_DATABASE_PASSWORD }}
        run: |
          terraform init \
            -backend-config="resource_group_name=dculus-global-terraform-assets-resource-grp" \
            -backend-config="storage_account_name=dculusterraformstates" \
            -backend-config="container_name=dculus-forms-mongodb-${{ github.event.inputs.environment }}-state" \
            -backend-config="key=terraform.tfstate"

      - name: FINAL WARNING - Database Destruction
        run: |
          echo "âš ï¸âš ï¸âš ï¸ FINAL WARNING âš ï¸âš ï¸âš ï¸"
          echo ""
          echo "You are about to PERMANENTLY DELETE the MongoDB Atlas database:"
          echo "  Project: dculus-forms-${{ github.event.inputs.environment }}"
          echo "  Cluster: dculus-forms-${{ github.event.inputs.environment }}-mongodb"
          echo ""
          echo "This will DELETE ALL DATA including:"
          echo "  - All forms"
          echo "  - All form responses"
          echo "  - All users and authentication data"
          echo "  - All organizations"
          echo "  - All configuration data"
          echo ""
          echo "âš ï¸ M0 FREE TIER HAS NO BACKUPS âš ï¸"
          echo "âš ï¸ DATA CANNOT BE RECOVERED âš ï¸"
          echo "âš ï¸ THIS IS PERMANENT AND IRREVERSIBLE âš ï¸"
          echo ""
          echo "Proceeding with destruction in 10 seconds..."
          sleep 10

      - name: Terraform Destroy
        env:
          TF_VAR_mongodb_atlas_public_key: ${{ secrets.MONGODB_ATLAS_PUBLIC_KEY }}
          TF_VAR_mongodb_atlas_private_key: ${{ secrets.MONGODB_ATLAS_PRIVATE_KEY }}
          TF_VAR_mongodb_atlas_org_id: ${{ secrets.MONGODB_ATLAS_ORG_ID }}
          TF_VAR_database_password: ${{ secrets.MONGODB_DATABASE_PASSWORD }}
        run: |
          echo "ðŸ”¥ Destroying MongoDB Atlas database..."
          terraform destroy -auto-approve
          echo "âœ… MongoDB Atlas database destroyed - ALL DATA PERMANENTLY DELETED"

  # Generate destruction summary
  destroy-summary:
    name: Destruction Summary
    runs-on: ubuntu-latest
    needs: [
      validate-destroy-request,
      cleanup-azure-custom-domain,
      terraform-azure-destroy,
      terraform-cloudflare-destroy,
      terraform-mongodb-destroy
    ]
    if: always()
    steps:
      - name: Generate Summary
        run: |
          echo "# ðŸ”¥ Multi-Cloud Infrastructure Destruction Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Environment**: \`${{ github.event.inputs.environment }}\`" >> $GITHUB_STEP_SUMMARY
          echo "**Triggered by**: @${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "**Date**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "**Confirmation**: âœ… \`${{ github.event.inputs.confirmation }}\` verified" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          echo "## âš ï¸ DESTRUCTION STATUS" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Component | Destroy Requested | Status | Data Loss |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|-------------------|--------|-----------|" >> $GITHUB_STEP_SUMMARY

          # Azure Status
          if [ "${{ github.event.inputs.destroy_azure }}" = "true" ]; then
            AZURE_STATUS="${{ needs.terraform-azure-destroy.result == 'success' && 'âœ… Destroyed' || 'âŒ Failed' }}"
            echo "| Azure Container Apps | âœ… Yes | $AZURE_STATUS | â„¹ï¸ No data stored |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Azure Container Apps | âŒ No | â­ï¸ Skipped | - |" >> $GITHUB_STEP_SUMMARY
          fi

          # Cloudflare Status
          if [ "${{ github.event.inputs.destroy_cloudflare }}" = "true" ]; then
            CF_STATUS="${{ needs.terraform-cloudflare-destroy.result == 'success' && 'âœ… Destroyed' || 'âŒ Failed' }}"
            echo "| Cloudflare R2 | âœ… Yes | $CF_STATUS | âš ï¸ ALL FILES LOST |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Cloudflare R2 | âŒ No | â­ï¸ Skipped | - |" >> $GITHUB_STEP_SUMMARY
          fi

          # MongoDB Status
          if [ "${{ github.event.inputs.destroy_mongodb }}" = "true" ]; then
            MONGO_STATUS="${{ needs.terraform-mongodb-destroy.result == 'success' && 'âœ… Destroyed' || 'âŒ Failed' }}"
            echo "| MongoDB Atlas | âœ… Yes | $MONGO_STATUS | âš ï¸âš ï¸ ALL DATA LOST |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| MongoDB Atlas | âŒ No | â­ï¸ Skipped | - |" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY

          # Detailed destruction info
          if [ "${{ needs.terraform-azure-destroy.result }}" = "success" ]; then
            echo "## ðŸ”· Azure Container Apps Destroyed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "- **Resource Group**: \`dculus-forms-${{ github.event.inputs.environment }}-rg\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "- **Container App**: \`dculus-forms-${{ github.event.inputs.environment }}-backend\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "- **Log Analytics**: All monitoring data - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          if [ "${{ needs.terraform-cloudflare-destroy.result }}" = "success" ]; then
            echo "## â˜ï¸ Cloudflare R2 Buckets & CDN Destroyed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "- **Private Bucket**: \`dculus-forms-private-${{ github.event.inputs.environment }}\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "  - All user uploads and attachments - PERMANENTLY LOST" >> $GITHUB_STEP_SUMMARY
            echo "- **Public Bucket**: \`dculus-forms-public-${{ github.event.inputs.environment }}\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "  - All public assets and images - PERMANENTLY LOST" >> $GITHUB_STEP_SUMMARY
            echo "- **CDN Domain**: \`public-cdn-${{ github.event.inputs.environment }}.dculus.com\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "  - DNS record removed" >> $GITHUB_STEP_SUMMARY
            echo "  - Custom domain disconnected" >> $GITHUB_STEP_SUMMARY
            echo "  - Page rule removed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          if [ "${{ needs.terraform-mongodb-destroy.result }}" = "success" ]; then
            echo "## ðŸƒ MongoDB Atlas Database Destroyed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "- **Project**: \`dculus-forms-${{ github.event.inputs.environment }}\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "- **Cluster**: \`dculus-forms-${{ github.event.inputs.environment }}-mongodb\` - DELETED" >> $GITHUB_STEP_SUMMARY
            echo "- **Database**: All forms, responses, users, organizations - PERMANENTLY LOST" >> $GITHUB_STEP_SUMMARY
            echo "- **Region**: AWS Mumbai (ap-south-1)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ **WARNING**: M0 free tier has NO backups. Data cannot be recovered." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi

          # Recovery info
          echo "## â„¹ï¸ Important Notes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **Terraform state preserved** - Infrastructure can be recreated" >> $GITHUB_STEP_SUMMARY
          echo "âŒ **Data cannot be recovered** - No backups exist for destroyed resources" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”„ **To recreate infrastructure**: Run Multi-Cloud Deployment workflow" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ **Note**: Recreated infrastructure will start with empty databases" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“– **Documentation**: [Destruction Guide](https://github.com/${{ github.repository }}/tree/main/infrastructure/multi-cloud/terraform/DESTROY_GUIDE.md)" >> $GITHUB_STEP_SUMMARY
